# MICHE VIDEO - 動画配信プラットフォーム仕様

## コンセプト

**MICHE VIDEO**は、STUDIOに登録されたIPを使った動画を投稿・視聴できるプラットフォーム。

YouTube/TikTokライクなシンプルな動画配信サービスに、Netflix風の長編コンテンツ、ライブ配信、投げ銭機能を統合。

---

## 目的

1. **クリエイター視点**
   - IPを使った動画を投稿できる
   - 視聴数・サブスク・投げ銭で収益化
   - ライブ配信でリアルタイム収益

2. **視聴者視点**
   - 多様な動画コンテンツを楽しめる
   - サブスクでプレミアム体験
   - 好きなクリエイターを直接支援

3. **IPホルダー視点**
   - 自分のIPが使われた動画の収益を自動で受け取れる
   - 使用履歴が透明に記録される
   - 不正利用を申告・管理できる

---

## 主要機能

### 1. 動画投稿・管理

**動画アップロード:**
- タイトル、説明文、タグ入力
- カテゴリ選択（教育、エンタメ、ゲーム、音楽など）
- **STUDIOからIPライセンスを選択して紐付け**
- サムネイル自動生成 or カスタムアップロード
- 公開範囲設定（公開/限定公開/プライベート）
- 成人向けフラグ（`is_adult`）の設定

**対応形式:**
- 動画: MP4, MOV, AVI（最大20GB）
- 自動トランスコード: 480p/720p/1080p
- アダプティブビットレートストリーミング

**動画管理:**
- タイトル・説明文・タグの編集
- サムネイル変更
- 動画の削除（論理削除、30日後に物理削除）
- 一括操作対応

### 2. 動画視聴

**プレイヤー機能:**
- 再生・一時停止・シーク
- 音量調整・ミュート
- 画質選択（480p/720p/1080p）
- 再生速度変更（0.5x～2.0x）
- フルスクリーン表示
- ピクチャーインピクチャー（PiP）

**視聴履歴:**
- 視聴進捗の自動保存
- 続きから再生
- 視聴履歴一覧

**インタラクション:**
- いいね/いいね解除
- コメント投稿・返信
- 共有機能（SNS連携）

### 3. ショート動画（TikTokライク）

**仕様:**
- 最大60秒の縦型動画
- スワイプで次の動画へ
- 無限スクロールフィード
- アルゴリズムベースのレコメンド

**機能:**
- いいね、コメント、共有
- 音源の再利用
- ハッシュタグ検索

### 4. Netflix風コンテンツ

**長編コンテンツ対応:**
- 映画・ドラマシリーズの配信
- シーズン・エピソード管理
- 視聴進捗の保存
- 次のエピソード自動再生

**Premium以上限定:**
- Free プランでは視聴不可
- Premium/Premium+ で視聴可能

### 5. ライブ配信

**配信機能:**
- リアルタイムストリーミング（RTMP）
- 最大4K配信対応
- 同時視聴者数表示
- チャット機能

**スーパーチャット:**
- ¥100～¥50,000の投げ銭
- コメント付き投げ銭
- プラットフォーム手数料30%

**配信管理:**
- 配信スケジュール設定
- アーカイブ自動保存
- 配信統計（視聴者数推移、収益など）

### 6. 収益化

**収益源:**
1. **サブスクリプション収益**（クリエイター向け分配）
2. **広告収益**（Free プラン視聴時）
3. **投げ銭**（ライブ配信中）
4. **Netflixコンテンツ視聴料**（視聴数ベース）

**分配ルール:**
- プラットフォーム手数料: 30%
- 残り70%をIPホルダーとクリエイターで分配
- 保留期間: 14日間
- 出金可能: ¥3,000以上

**出金方法:**
- 銀行振込
- PayPal
- Stripe Connect

### 7. 検索・レコメンデーション

**検索機能:**
- 全文検索（タイトル、説明文、タグ）
- フィルター（カテゴリ、アップロード日、長さ）
- ソート（関連度、視聴数、新着順）
- サジェスト機能

**レコメンデーション:**
- 視聴履歴ベースのパーソナライズ
- トレンド動画
- 関連動画
- フォロー中のチャンネル新着

### 8. ソーシャル機能

**チャンネル:**
- クリエイターダッシュボード
- チャンネル登録/解除
- 通知設定

**コミュニティ:**
- コメント・返信
- いいね/ディスライク
- プレイリスト作成・共有
- アクティビティフィード

---

## STUDIOとの連携

### IPライセンス紐付けフロー

```
1. クリエイターが動画アップロード
   ↓
2. STUDIOのAPIを叩いて利用可能なIPライセンス一覧を取得
   ↓
3. クリエイターがIPライセンスを選択（オプション）
   ↓
4. 動画とIPライセンスIDを紐付けてDB保存
   ↓
5. 視聴時に視聴数・収益情報をSTUDIOに送信
```

### 収益情報の送信

**送信タイミング:**
- 動画視聴時（視聴カウント）
- 投げ銭受領時
- サブスク収益発生時

**送信データ:**
```json
{
  "video_id": "vid_xxxxx",
  "ip_license_id": "ip_xxxxx",
  "event_type": "view" | "tip" | "subscription",
  "revenue_amount": 100,
  "timestamp": "2025-01-01T12:00:00Z",
  "user_id": "usr_xxxxx"
}
```

**STUDIO側の処理:**
- 収益データを記録
- ライセンス条件に基づいて分配比率を計算
- IPホルダーとクリエイターに収益を分配

---

## プラン別機能制限

| 機能 | Free | Premium | Premium+ |
|-----|------|---------|----------|
| 基本動画視聴 | ✅ | ✅ | ✅ |
| 広告 | あり | なし | なし |
| 画質 | 720p | 1080p | 1080p |
| ダウンロード | ❌ | ✅ | ✅ |
| Netflixコンテンツ | ❌ | ✅ | ✅ |
| **成人コンテンツ** | ❌ | ❌ | ✅（年齢確認必須） |
| ライブ配信視聴 | ✅ | ✅ | ✅ |
| 投げ銭 | ✅ | ✅ | ✅ |

---

## データモデル概要

### 主要テーブル

**videos**
- 動画の基本情報（タイトル、説明文、URL、サムネイル）
- IPライセンスID（`ip_license_id`）
- 成人向けフラグ（`is_adult`）
- 視聴数、いいね数

**shorts**
- ショート動画の情報（60秒以内）
- 音源情報、ハッシュタグ

**netflix_contents**
- 映画・シリーズの情報
- シーズン・エピソード管理
- IPライセンスID必須

**live_streams**
- ライブ配信情報
- ストリームキー、RTMP URL
- 同時視聴者数

**earnings**
- 収益記録（サブスク、広告、投げ銭）
- IPホルダー・クリエイター別の分配額
- 保留期間・出金状態

詳細は `docs/specs/references/data-models.md` を参照。

---

## 技術仕様

### 動画配信基盤

**ストレージ:**
- AWS S3（バケット: `miche-video-storage`）
- リージョン: ap-northeast-1（東京）

**トランスコード:**
- AWS MediaConvert
- 出力形式: HLS (HTTP Live Streaming)
- 解像度: 480p/720p/1080p

**CDN:**
- AWS CloudFront
- 署名付きURL（有効期限24時間）

**ライブ配信:**
- AWS MediaLive + MediaPackage
- RTMP入力、HLS出力

### API設計

**認証:**
- JWT（アクセストークン: 15分、リフレッシュトークン: 7日間）
- プラットフォーム識別子（`plat: 'app' | 'web'`）

**レート制限:**
- アップロード: 10回/日
- API呼び出し: 1000回/時間

**エンドポイント例:**
- `POST /api/videos/upload` - 動画アップロード開始
- `GET /api/videos/:id` - 動画詳細取得
- `POST /api/videos/:id/view` - 視聴記録
- `GET /api/search` - 動画検索
- `POST /api/live/create` - ライブ配信作成

詳細は `docs/specs/references/api-endpoints.md` を参照。

---

## セキュリティ

### 成人コンテンツ制御

**アプリ（iOS/Android）:**
- `is_adult=true` のコンテンツは完全に非表示
- JWT内の `plat='app'` で識別
- データベースRLSで制御

**Web:**
- 年齢確認後に成人コンテンツ表示
- `plat='web'` かつ年齢確認済みユーザーのみアクセス可能

### コンテンツモデレーション

- AI自動審査（不適切コンテンツ検出）
- ユーザー通報機能
- クリエイターへの警告・アカウント停止

### 著作権保護

- ContentID類似の自動検出
- DMCA対応フロー
- IP侵害申告機能（STUDIO連携）

---

## パフォーマンス目標

- **動画一覧取得**: < 300ms (P95)
- **動画詳細取得**: < 200ms (P95)
- **検索**: < 500ms (P95)
- **ライブ配信遅延**: < 5秒
- **アップロード成功率**: > 99.5%

---

## 今後の拡張

- **コラボ機能** - 複数クリエイターで1つの動画を作成
- **シリーズ管理** - 動画をシリーズ化して管理
- **プレミアム公開** - 有料視聴者限定公開
- **クリエイターランク** - 実績に応じた特典
- **ギフト機能** - 視聴者間でギフト送信
